{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h4>üìö {{ quiz_info.title }} - È¢òÁõÆ {{ question.question_number }}</h4>
                    <small class="text-muted">Á¨¨ {{ current_position }}/{{ total_questions }} È¢ò</small>
                </div>
                <div class="progress mt-2">
                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ (current_position/total_questions)*100 }}%"></div>
                </div>
            </div>            <div class="card-body">
                <h5 class="card-title">{{ question.question_text | replace('\n', '<br>') | safe }}</h5>
                  <!-- Display image if question has one -->
                {% if question.has_image and question.image_src %}
                <div class="text-center my-4">
                    {% if question.image_src.startswith('data:image/') %}
                        <!-- Base64 embedded image -->
                        <img src="{{ question.image_src }}" 
                             alt="{{ question.image_alt or 'È¢òÁõÆÂõæÁâá' }}" 
                             class="img-fluid border rounded shadow-sm" 
                             style="max-width: 100%; height: auto;">
                    {% else %}
                        <!-- File-based image -->
                        {% set clean_filename = question.image_src.replace('\\', '/').replace('images/', '').replace('images\\', '') %}
                        <img src="{{ url_for('quiz_images', filename=clean_filename) }}" 
                             alt="{{ question.image_alt or 'È¢òÁõÆÂõæÁâá' }}" 
                             class="img-fluid border rounded shadow-sm" 
                             style="max-width: 100%; height: auto;"
                             onerror="this.style.display='none'; document.getElementById('image-error-{{ question.question_number }}').style.display='block';">
                        <div id="image-error-{{ question.question_number }}" class="alert alert-warning mt-2" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i> ÂõæÁâáÊó†Ê≥ïÂä†ËΩΩ: {{ clean_filename }}
                            <br><small>ËØ∑Á°Æ‰øùÂõæÁâáÊñá‰ª∂Â≠òÂú®‰∫é source_challenges/images/ ÁõÆÂΩï‰∏≠</small>
                        </div>
                    {% endif %}
                </div>
                {% endif %}
                
                <!-- Display options -->
                {% if question.options and question.options|length > 0 %}
                <div class="mt-4">
                    <h6>ÈÄâÈ°πÔºö</h6>
                    {% for option in question.options %}
                    <div class="mb-2 p-2 border rounded {% if option.startswith(question.correct_answer[0] + '.') or option == question.correct_answer %}bg-success text-white{% else %}bg-light{% endif %}">
                        {% if option.startswith('A.') or option.startswith('B.') or option.startswith('C.') or option.startswith('D.') %}
                            {{ option }}
                            {% if option.startswith(question.correct_answer[0] + '.') or option[3:].strip() == question.correct_answer %}
                                <i class="fas fa-check-circle float-end"></i>
                            {% endif %}
                        {% else %}
                            {{ ['A', 'B', 'C', 'D'][loop.index0] }}. {{ option }}
                            {% if option == question.correct_answer %}
                                <i class="fas fa-check-circle float-end"></i>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Correct answer -->
                <div class="mt-4">
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle"></i> Ê≠£Á°ÆÁ≠îÊ°à</h6>
                        <strong>{{ question.correct_answer }}</strong>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="d-flex justify-content-between mt-4">
                    <div>
                        {% if prev_question %}
                        <a href="{{ url_for('study_question', quiz_id=quiz_id, question_number=prev_question) }}" 
                           class="btn btn-outline-primary">
                            <i class="fas fa-chevron-left"></i> ‰∏ä‰∏ÄÈ¢ò
                        </a>
                        {% else %}
                        <button class="btn btn-outline-secondary" disabled>
                            <i class="fas fa-chevron-left"></i> ‰∏ä‰∏ÄÈ¢ò
                        </button>
                        {% endif %}
                    </div>
                    
                    <div>
                        <a href="{{ url_for('study_quiz', quiz_id=quiz_id) }}" class="btn btn-outline-info">
                            <i class="fas fa-list"></i> È¢òÁõÆÂàóË°®
                        </a>
                    </div>
                    
                    <div>
                        {% if next_question %}
                        <a href="{{ url_for('study_question', quiz_id=quiz_id, question_number=next_question) }}" 
                           class="btn btn-outline-primary">
                            ‰∏ã‰∏ÄÈ¢ò <i class="fas fa-chevron-right"></i>
                        </a>
                        {% else %}
                        <button class="btn btn-outline-secondary" disabled>
                            ‰∏ã‰∏ÄÈ¢ò <i class="fas fa-chevron-right"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Quick navigation -->
                <div class="mt-4">
                    <h6>Âø´ÈÄüË∑≥ËΩ¨Ôºö</h6>
                    <div class="d-flex flex-wrap gap-1">
                        {% for i in range(1, total_questions + 1) %}
                        {% if i == question.question_number %}
                        <span class="btn btn-primary btn-sm">{{ i }}</span>
                        {% else %}
                        <a href="{{ url_for('study_question', quiz_id=quiz_id, question_number=i) }}" 
                           class="btn btn-outline-secondary btn-sm">{{ i }}</a>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
